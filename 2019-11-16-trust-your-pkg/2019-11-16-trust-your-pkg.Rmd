---
title: "Can you trust your R package? `r emo::ji('package')`"
subtitle: "SatRday Cardiff 2019"
author: '`r jrPresentation::get_author()`'
output:
  xaringan::moon_reader:
    css: ["default", "style.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE, message=FALSE}
options(htmltools.dir.version = FALSE)
library("jrPresentation")
set_presentation_options()
knitr::opts_chunk$set(cache = FALSE)
```


layout:true
`r add_border(inverse=FALSE)`

---

# Jumping Rivers

.pull-left[
<img src="assets/robot.jpg"></img>
]


.pull-right[


* On-site training (RSS accredited)

* R and python consultancy

* Dashboard creation

* Code review

* Continuous integration

* RStudio full service certified partners

* System architecture

* R Package development

* Predictive analytics
  ]
  
---

# Our clients

<div id="clients">
<img src="assets/shell.png"></img><img src="assets/sustrans.png"></img>
<img src="assets/yorkshire.png"></img><img src="assets/hastings.png"></img>
<img src="assets/Pragmatic.png" style=position:relative;top:*2.5rem></img><img src="assets/nhs.png"></img>
<img src="assets/royal_statistical_society.jpg"></img><img src="assets/Francis_Crick_Institute.png"></img>
<img src="assets/Ministry_of_Defence.png"></img><img src="assets/University_of_Manchester.png"></img>
<img src="assets/scot-gov.png"></img>
<img src="assets/ea.png" style=position:relative;top:-3rem></img>
</div>

---

# Hands up... `r emo::ji("raising_hand_woman")`

* If you've written a function before?

--

* If you've written an R package before?

--

* If you've used version control before?

--

* If you've used continuous integration before?

---


# What is continuous integration? 
Make change ->
Test ->
Pass  -> keepworking
Fail -> fix it!


* members of a team integrate their work frequently (daily)
* Each integration is verified by an automated build (usually including tests) 
* minimize the cost of integratio
* build healthier software by developing and testing in smaller increments
* automated processes build a working version of the project
* test suites are run against the new build to check whether any bugs were introduced.
* It is easier to fix a bug in something you wrote a few minutes ago than something you wrote yesterday
* robust test suites and an automated system to run those tests
* implement small changes and check in code to version control repositories frequently. 
* establish a consistent and automated way to build, package, and test applications
* build server that triggers a build whenever you push changes to a source code repository.

---

# Why use CI?


* Get daily constant feedback `r emo::ji("repeat")`

* Catch bugs early `r emo::ji("bug")`

* Avoid the monster commit. `r emo::ji("japanese_ogre")`

* You don't have to remember to run `devtools::check()` `r emo::ji("person_facepalming")`
---

# Travis?

.pull-left[

* A hosted continuous integration service

* Used to build and test software projects hosted at GitHub

* Essentially a push to GitHub, triggers another job

* this job could be anything e.g. checking an R package
]

.pull-right[
<img src="assets/travis.png"></img>
]


---

# How to set it up?

* Host your R package on github
* Create a .travis.yml file `usethis::use_travis()`
* Go to travis-ci.org, accept to link your github account with travis
* Turn on ci for your project by switching the button shown in travis-ci

Travis will attach a badge to the results, green if all steps in the script (which run the tests) pass, red if not. 

```{r, eval = FALSE}
> usethis::use_travis()
✔ Setting active project to '/home/rhian/Documents/presentations/2019-11-16-trust-your-pkg'
✔ Writing '.travis.yml'
✔ Adding '^\\.travis\\.yml$' to '.Rbuildignore'
● Turn on travis for your repo at https://travis-ci.org/profile/trianglegirl
● <!-- badges: start -->
  [![Travis build status](https://travis-ci.org/trianglegirl/presentations.svg?branch=master)](https://travis-ci.org/trianglegirl/presentations)
  <!-- badges: end -->
```

  - [GITHUB_PAT](https://itsalocke.com/blog/using-travis-make-sure-you-use-a-github-pat/)
  
---

# An example `travis.yml` file


```{}
language: r
cache: packages

r:
  - oldrel
  - release
  - devel

notifications:
  email:
    recipients:
     - alerts@jumpingrivers.support
    on_success: change
    on_failure: change
```
---

class: center, middle, inverse

![](assets/no-pass.gif)

---

class: center, middle, inverse

![](assets/dammit-travis.png)

---

# Travis jobs

* Twitter
* Pushbullet
* Shiny badges
* tests
* covereage
* websites
* Testing using different versions of R

---

# Jumping Rivers and CI

* Packages for learners
* Packages for clients
* Remote team, sharing projects

Notes build ok
Notes are building using up-to-date-packages
Spell checking
Dead links
Correct formatting

---

# Example

```
◉ Comparing to master
✔ Update to date with master
◉ Checking template files...check_template()
  ◉ Cloning template repo
  ◉ Checking gitlab-ci.yml
✔ Template files look good
◉ Checking package versions...check_pkgs()
  ✔ ggplot2 (v3.2.1) is up to date
  ✔ knitr (v1.25) is up to date
◉ Spell check (experimental)...check_spelling()
◉ Checking chapters for title case...check_chapter_titles()
✔ Titles look good
◉ Checking section for sentence case...check_section_titles()
◉ Checking for full stops...check_fullstops()
✔ Captions and friends look good look good
◉ Checking for undefined citations...check_citations()
✔ Citations look good
◉ Checking for duplicate labels...check_labels()
✔ Labels look good
◉ Checking for undefined refs...check_references()
✔ Refs look good
◉ Checking URLS...check_urls()
✔ URLs look good
◉ Checking lint...check_code_style()
✔ Styling looks good
◉ Checking version in config.yml...check_version()
✔ Config looks good!
◉ Checking for uncommitted files...check_unstaged()
✔ Everything committed!
★ ★ You are fabulous! ★ ★
```
---

# inteRgrate `r emo::ji("package")`

We wanted to **simpilfy** and **standardise** the way we use CI at Jumping Rivers

* Make continuous integration more consistent across platforms
* Specify the exact number of NOTES and WARNINGS we allow.
* Include additional checks
    * lints
    * not using imports within namespaces
* Can use it on travis-ci, gitlab-ci or just in R.

---

# Main functions of inteRgrate `r emo::ji("heavy_check_mark")`

  * `check_pkg()`
  * `check_r_filenames()`
  * `check_tidy_description()`
  * `check_lintr()`
  * `check_namespace()`

```{}
inteRgrate::check_lintr()
◉ Checking lint...check_lintr()
◉ Checking vignettes
..........
✔ Lint looks good
```
  

---

# Summary 

.pull-left[

* Do use continous integration `r emo::ji("heavy_check_mark")`

* Don't get upset when it fails `r emo::ji("weary")`

* Feel happy that you've taken a step toward more robust code `r emo::ji("lock")`

* Chat to us if you need help `r emo::ji("email")`


#### Resources
* [inteRgrate](https://github.com/jumpingrivers/inteRgrate)
* [usethis](https://usethis.r-lib.org/)
* [tic](https://github.com/ropenscilabs/tic)
* [Julia's blogpost](https://juliasilge.com/blog/beginners-guide-to-travis/)

]

.pull-right[
![](assets/failing.jpg)
]